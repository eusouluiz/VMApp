<app-header [titulo]="responsavel.nome" [botaoRetorno]="true"></app-header>

<ion-content class="ion-padding">
  <form [formGroup]="form" (ngSubmit)="salvar()">
    <ion-row size="12">
      <ion-col size="12" size-md="6" size-lg="6">
        <app-field-input formControlName="nome" label="Nome"></app-field-input>
      </ion-col>
      <ion-col size="12" size-md="6" size-lg="6">
        <app-field-input formControlName="telefone" label="Telefone"></app-field-input>
      </ion-col>
    </ion-row>
    <hr>
    <!-- INICIO SOBRE ALUNO -->
    <ion-row>
      <ion-row class="ion-align-items-center ion-margin-vertical" size="auto">
        <ion-col class="ion-no-padding" size="12" sizeLg="4" sizeMd="4">
          <h3 class="u-font-weight--bold">Responsável por:</h3>
        </ion-col>
        <!-- INICIO INSERCAO ALUNOS -->
        <ion-col offsetLg="2" offsetMd="2" size="12" sizeLg="6" sizeMd="6"
          style="min-height: 80px;">
          <ng-container *ngIf="!isModoDetalhes()">
            <form [formGroup]="formBuscaAluno">
              <app-autocomplete-v2 formControlName="busca" idBusca="busca-aluno" [listaItens]="nomeAlunosBusca" (onBusca)="adicionarAluno($event)" 
                textoSemResultado="Cadastrar novo aluno" icone="add" (onCliqueIcone)="navegarTelaAluno(-1)"></app-autocomplete-v2>
            </form>
          </ng-container>
        </ion-col>
        <!-- FIM INSERCAO ALUNOS -->
      </ion-row>
      <!-- INICIO TABELA DE ALUNOS -->
      <ion-row size="auto">
        <table>
          <tr>
            <th>Aluno</th>
            <th>Turma</th>
            <th></th>
          </tr>
          <ng-container *ngIf="listaAlunosTabela.length > 0; then thenTemplate; else elseTemplate"></ng-container>
          <ng-template #thenTemplate>
            <tr *ngFor="let aluno of listaAlunosTabela">
              <td style="width: 45%;">{{aluno.nome}}</td>
              <td style="width: 45%;">{{aluno.turma.nome}}</td>
              <td style="width: 10%;">
                <div style="text-align: -webkit-right;">
                  <ion-fab-button *ngIf="isModoDetalhes()" color="secondary" size="small"
                    (click)="navegarTelaAluno(aluno.idAluno)">
                    <ion-icon name="information"></ion-icon>
                  </ion-fab-button>
                  <ion-fab-button *ngIf="!isModoDetalhes()" color="danger" size="small" 
                    (click)="deletarAluno(aluno.idAluno)">
                    <ion-icon name="trash"></ion-icon>
                  </ion-fab-button>
                </div>
              </td>
            </tr>
          </ng-template>
          <ng-template #elseTemplate>
            <tr>
              <td class="c-tabela-colunaunica u-font-weight--bold" colspan="100%">Selecione um Aluno</td>
            </tr>
          </ng-template>
          
        </table>
      </ion-row>
      <!-- FIM TABELA DE ALUNOS -->
    </ion-row>
    <!-- FIM SOBRE ALUNO -->
    <ion-row class="ion-margin-vertical">
      <ion-row>
        <h3 class="u-font-weight--bold">Informações para Login:</h3>
      </ion-row>
      <ion-row size="12">
        <ion-col size="12" size-md="6" size-lg="6">
          <app-field-input formControlName="cpf" label="CPF"></app-field-input>
        </ion-col>
        <ion-col size="12" size-md="6" size-lg="6">
          <app-field-password formControlName="senha" label="Senha"></app-field-password>
        </ion-col>
      </ion-row>
    </ion-row>
    <ng-container id="botoesEditar" *ngIf="!isModoDetalhes()">
      <ion-row style="flex-direction: row-reverse;">
        <ion-col size="auto">
          <ion-button shape="round" type="submit">Salvar</ion-button>
        </ion-col>
        <ion-col size="auto">
          <ion-button shape="round" fill="outline" color="danger" (click)="cancelar()">Cancelar</ion-button>
        </ion-col>
      </ion-row>
    </ng-container>
  </form>
  <!-- BOTOES DE CONTROLE -->
  <ng-container *ngIf="isModoDetalhes()">
    <app-botoes-controle (onEditar)="iniciarEdicao()" (onDeletar)="deletarAction()" 
      header="Deseja deletar {{responsavel.nome}}?"></app-botoes-controle>  
  </ng-container>
</ion-content>